---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

```{r}
path <- here("test.xlsx")
df <- import_fichier(path)


```

```{r}

content <- df %>%
      group_by(exercice) %>%
      summarise(min_poids = min(poids, na.rm = T),
                mean_poids = mean(poids, na.rm = T),
                max_poids = max(poids, na.rm = T),
                min_serie = min(serie, na.rm = T),
                mean_serie = mean(serie, na.rm = T),
                max_serie = max(serie, na.rm = T)) %>% 
  ungroup()

```

```{r}

time_content <- df %>% 
  group_by(date) %>% 
  summarise(exercices = n_distinct(exercice),
            series = sum(serie, na.rm = T),
            poids = sum(poids, na.rm = T)) %>% 
  ungroup() %>% 
  pivot_longer(!c(date, poids), names_to = 'gr', values_to = 'value')


hc <- highchart()%>%
  hc_xAxis(type = "datetime", labels = list(format = '{value:%m/%d}')) %>%
hc_yAxis_multiples(list(title = list(text = "Exercices / Séries"),
labels=list(format = '{value}'),
showFirstLabel = TRUE,
showLastLabel=TRUE,
opposite = FALSE),
list(title = list(text = "Charges (Kg)"),
labels = list(format = "{value}"),showLastLabel = FALSE, opposite = TRUE)) %>%
hc_plotOptions(column = list(stacking = "normal")) %>%
hc_add_series(time_content,type="column",hcaes(x=date,y=value, group = 'gr'),yAxis=0) %>%
hc_add_series(time_content,type="line",hcaes(x=date,y=poids), yAxis = 1, name = 'Charge')
hc

```


```{r}

exdf <- df %>% filter(exercice == 'DC') %>% 
   pivot_longer(!c(date, exercice, poids), names_to = 'gr', values_to = 'value')

hc <- highchart()%>%
  hc_xAxis(type = "datetime", labels = list(format = '{value:%m/%d}')) %>%
hc_yAxis_multiples(list(title = list(text = "Exercices / Séries"),
labels=list(format = '{value}'),
showFirstLabel = TRUE,
showLastLabel=TRUE,
opposite = FALSE),
list(title = list(text = "Charges (Kg)"),
labels = list(format = "{value}"),showLastLabel = FALSE, opposite = TRUE)) %>%
# hc_plotOptions(column = list(stacking = "normal")) %>%
hc_add_series(exdf,type="column",hcaes(x=date,y=value, group = 'gr'),yAxis=0) %>%
hc_add_series(exdf,type="line",hcaes(x=date,y=poids), yAxis = 1, name = 'Charge')
hc
```

```{r}

data_plot_ex <- df %>% filter(exercice == 'DC') %>% 
      mutate(max = round(poids / (1.0279 - (0.0278*reps)),1)) %>%
      arrange(date) %>%
      mutate(evol = round((max - lag(max))/max,2),
             evol = ifelse(is.na(evol), 0, evol))

```

```{r}

rep = 10
poids = 50
max <- round(poids / (1.0279 - (0.0278*rep)),1)

poids_opti <- c()
reps <- c()

for( i in (1:20)){
  reps <- c(reps, i)
  compute_poids <- round(max*(1.0279 - (0.0278*i)), 2)
  poids_opti <- c(poids_opti, compute_poids)
}

df_opti <- data.frame(reps, poids_opti)


hc <- highchart()%>%
    # hc_xAxis(type = "datetime", labels = list(format = '{value:%m/%d}')) %>%
    # hc_yAxis_multiples(list(title = list(text = "Exercices / Séries"),
    #                         labels=list(format = '{value}'),
    #                         showFirstLabel = TRUE,
    #                         showLastLabel=TRUE,
    #                         opposite = FALSE),
    #                    list(title = list(text = "Charges (Kg)"),
    #                         labels = list(format = "{value}"),showLastLabel = FALSE, opposite = TRUE)) %>%
    # hc_plotOptions(column = list(stacking = "normal")) %>%
    hc_add_series(df_opti,type="column",hcaes(x=reps,y=poids_opti),yAxis=0)

hc

```


